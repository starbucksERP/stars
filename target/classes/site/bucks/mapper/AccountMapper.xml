<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 사용 테이블 :  (매퍼끼리는 성격 맞는거 묶어서 해주시면 감사)-->
<mapper namespace="site.bucks.mapper.AccountMapper">
<!--  
	지점매입과 본사매출 공통(테이블 사용하는것 같음)으로 사용

<<<<<<< HEAD
	<!-- 지점매입과 본사매출 공통(테이블 사용하는것 같음)으로 사용 -->
	<!--  
=======
	지점매입과 본사매출 공통(테이블 사용하는것 같음)으로 사용
>>>>>>> branch 'master' of https://github.com/starbucksERP/stars.git
	<resultMap type="AccountPS" id="stPurchaseMainSaleMap">
		<association property="sih" javaType="StoreItemHistory">
			<result column="store_id" property="storeId"/>
			<result column="history_date" property="date"/>
			<result column="item_num" property="itemNum"/>
			<result column="item_name" property="itemName"/>
		</association>
		<association property="orderItem" javaType="OrderItem">
			<result column="item_pprice" property="itemPprice"/>
			<result column="item_sprice" property="itemSprice"/>
		</association>
	</resultMap>
	-->

	<!-- 지점매입,본사매출 출력 & 검색조건 -->
	<select id="selectPurchaseSaleList" resultType="Account">
		select sih.store_id, sih.history_date,sih.item_num, sih.item_name, ot.item_sprice, ot.item_pprice from 
			store_item_history sih join order_item oi
				on sih.request_num=oi.request_num where	sih.item_state=70
				<if test="storeId!=null and storeId!=''">
					and sih.store_id=#{storeId}
				</if>
				<if test="accountDate1!=null and accountDate1!='' and accountDate2!=null and accountDate2!=''">
					and sih.history_date between #{accountDate1} and #{accountDate2} 
				</if>
				<if test="itemName!=null and itemName!=''">
					and sih.item_name like '%'||#{itemName}||'%'
				</if>
			order by sih.history_date desc	
	</select>
</mapper>










