<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 사용 테이블 : 지점재고 / 지점재고history / 판매 / 상품레시피 -->
<mapper namespace="site.bucks.mapper.StoreItemMapper">
	
<!-- record 테이블 -->

	<!-- 재고 잔량 기록 -->
	<update id="updateRecord" parameterType="map">
	 	update record set item_rest=#{itemRest} where item=#{item}
	</update>
	
	<!-- 특정 재고 잔량 검색 -->
	<select id="selectItemRest" parameterType="string" resultType="int">
		select item_rest from record where item=#{item}
	</select>
	
<!-- record 테이블 -->	
	
	
	
<!-- sale 테이블 -->
	
	<!-- 판매 기록 -->
	<insert id="insertSale" parameterType="Sale">
		<selectKey resultType="int" keyProperty="saleNo" order="BEFORE">
			select sale_seq.nextval from dual		
		</selectKey>
		insert into sale values(#{saleNo},#{saleProduct},#{saleQty},sysdate)
	</insert>
	
	<!-- 판매 기록 검색 -->
	<select id="selectSaleList" resultType="Sale">
		select * from sale
	</select>
	
	<resultMap type="Sale" id="saleRM">
 		<association property="Sale">
 			<id column="sale_no" property="saleNo"/>
 			<result column="sale_product" property="saleProduct"/>
 			<result column="sale_qty" property="saleQty"/>
 			<result column="sale_date" property="saleDate"/>
 		</association>
 		<association property="Item">
 			<id column="item_code" property="itemNo"/>
 		</association>
 	</resultMap>
 	
	<!-- 상품명을 통한 카테고리 검색-->
	<select id="selectCategory" parameterType="Sale" resultType="saleRM">
		select A.*,B.ITEM_CODE from SALE A JOIN item B on B.item_name=A.#{saleProduct}
	</select>
	
<!-- sale 테이블 -->


<!-- productRecipe 테이블 -->

	<!-- 상품명을 통한 재료들 및 카테고리 검색 이용(커피종류만 해당) -->
	<select id="selectProduct" parameterType="Sale" resultType="ProductRecipe">
		select * from product_recipe where product=#{product}
	</select>
<!-- productRecipe 테이블 -->	
	
	
	

<!-- storeItem 테이블 -->
	<update id="updateStoreItem1" parameterType="map">
		update store_item set store_item_qty=store_item_qty-#{bundle} where store_item=#{item}
	</update> 
	
	<update id="updateStoreItem2" parameterType="map">
		update store_item set store_item_qty=store_item_qty-#{qty} where store_item=#{item}
	</update>
 
 
 	

<!-- storeItem 테이블 -->

	
	
	
	
</mapper>